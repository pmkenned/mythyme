<!DOCTYPE html>

<html>

<head>
<style>
html, body {
	margin: 0px;
	overflow-x: hidden;
}
</style>
</head>

<!--
See: https://www.epochconverter.com/weeknumbers
-->

<body>

<canvas id="myCanvas">
</canvas>

<script>

var jan_1_2018 = 1; // Monday
var days_per_month = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

var weekdays = [
    'Sunday',
    'Monday',
    'Tuesday',
    'Wednesday',
    'Thursday',
    'Friday',
    'Saturday',
];

var months = [
    'January',
    'February',
    'March',
    'April',
    'May',
    'June',
    'July',
    'August',
    'September',
    'October',
    'November',
    'December',
];


var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");

ctx.canvas.width  = window.innerWidth;
ctx.canvas.height = window.innerHeight-4; // will it always be 4?

var viewVars = {
    'day': {columns: 4, margin: 75, divs: 4, tmargin: 75},
    'week': {hours: 8, divs: 6, tmargin: 30, lmargin: 75, vspace: 0, vspace_h: 0, hspace: 0},
    'month': {tmargin: 30},
    'year': {rows: 3},
    'year2': {bw: 50},
    'sidebar' : {width: 200}
};

var viewMode = 'day';

var seconds;
var minutes;
var hour;
var year;
var month;
var day;
var dayOfWeek;
var milliSeconds;

function myGetTime() {
    var date = new Date;
    seconds = date.getSeconds();
    minutes = date.getMinutes();
    hour = date.getHours();
    year = date.getFullYear();
    month = date.getMonth(); // beware: January = 0; February = 1, etc.
    day = date.getDate();
    dayOfWeek = date.getDay(); // Sunday = 0, Monday = 1, etc.
    milliSeconds = date.getMilliseconds();
}

function draw() {
	ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

	ctx.canvas.width  = window.innerWidth;
	ctx.canvas.height = window.innerHeight-4; // will it always be 4?

    myGetTime();

    if(viewMode === 'day') {
        var columns = viewVars['day'].columns;
        var margin = viewVars['day'].margin;
        var tmargin = viewVars['day'].tmargin;
        var divs = viewVars['day'].divs;
        var hspace = canvas.width/columns;
        var rmargin = hspace - margin;

        // dashed lines
        var hours = 24;
        var vspace = (canvas.height - tmargin) * columns / (hours*divs);
        var vspace_h = vspace*divs;
        var hpc = Math.round(24/columns);

        ctx.font = "25px Arial";
        ctx.fillStyle = "#000000";
        ctx.fillText(weekdays[dayOfWeek] + ", " + months[month] + " " + day,50, tmargin-20);

        // dashed lines
        for(var i=0; i<hours*divs; i++) {
            ctx.beginPath();
            var y = Math.round(i * vspace)+0.5;
            ctx.moveTo(0, y+tmargin);
            ctx.lineTo(canvas.width, y+tmargin);
            ctx.lineWidth = 1;
            ctx.setLineDash([3, 1]);
            ctx.strokeStyle = "#e0e0e0";
            ctx.stroke();
            ctx.setLineDash([]);
        }

        // solid lines of hours
        for(var i=0; i<hours; i++) {
            ctx.beginPath();
            var y = Math.round(i * vspace_h);
            ctx.moveTo(0, y+tmargin);
            ctx.lineTo(canvas.width, y+tmargin);
            ctx.lineWidth = 2;
            ctx.setLineDash([]);
            ctx.strokeStyle = "#e0e0e0";
            ctx.stroke();

            ctx.font = "13px Arial";
            ctx.fillStyle = "#000000";
            var hourc1 = (12+(i-1)+ 0)%12+1;
            var hourc2 = (12+(i-1)+ 6)%12+1;
            var hourc3 = (12+(i-1)+12)%12+1;
            var hourc4 = (12+(i-1)+18)%12+1;
            ctx.fillText(hourc1 + ":00am",10         ,30 + i*vspace_h + tmargin);
            ctx.fillText(hourc2 + ":00am",10+1*hspace,30 + i*vspace_h + tmargin);
            ctx.fillText(hourc3 + ":00pm",10+2*hspace,30 + i*vspace_h + tmargin);
            ctx.fillText(hourc4 + ":00pm",10+3*hspace,30 + i*vspace_h + tmargin);
        }


        // vertical lines
        for(var i=0; i < columns; i++) {
            ctx.beginPath();
            var x = Math.round(i * hspace + margin)+0.5;
            ctx.moveTo(x, tmargin);
            ctx.lineTo(x, canvas.height);
            ctx.lineWidth = 1;
            ctx.setLineDash([]);
            ctx.strokeStyle = "#c0c0c0";
            ctx.stroke();

            ctx.beginPath();
            var x = Math.round((i+1) * hspace)+0.5;
            ctx.moveTo(x, tmargin);
            ctx.lineTo(x, canvas.height);
            ctx.lineWidth = 1;
            ctx.setLineDash([]);
            ctx.strokeStyle = "#000000";
            ctx.stroke();

        }

        // current time line
        var lc = Math.floor(hour/hpc);
        var lx = lc * hspace;
        var hy = (hour - lc*hpc) * vspace_h;
        var ty = hy + (minutes/60.0) * vspace_h;
        var ly = Math.round(ty)+0.5;
        ctx.beginPath();
        ctx.moveTo(lx, ly);
        ctx.lineTo(lx+hspace, ly);
        ctx.lineWidth = 3;
        ctx.setLineDash([]);
        ctx.strokeStyle = "#ff0000";
        ctx.stroke();
    }
    else if(viewMode === 'week') {

        var hours = viewVars['week'].hours;
        var divs = viewVars['week'].divs;
        var tmargin = viewVars['week'].tmargin;
        var lmargin = viewVars['week'].lmargin;
        var vspace = (canvas.height - tmargin)/(hours*divs);
        var vspace_h = vspace*divs;
        var hspace = (canvas.width - lmargin)/7;

        var top_hour = 13;

        ctx.font = "18px Arial";
        ctx.fillStyle = "#000000";
        for(var i=0; i<7; i++) {
            ctx.fillText(weekdays[i],i*hspace + lmargin + 10,tmargin-10);
        }


        ctx.font = "13px Arial";
        ctx.fillStyle = "#000000";
        for(var i=0; i<hours; i++) {
            var mhour = ((top_hour-12)+(i-1))%12+1;
            ctx.fillText(mhour + ":00pm",10,40 + i*vspace_h);
        }


        // vertical lines
        for(var i=0; i<7; i++) {
            ctx.beginPath();
            var x = lmargin + Math.round(i * hspace)+0.5;
            ctx.moveTo(x, 0);
            ctx.lineTo(x, canvas.height);
            ctx.lineWidth = 1;
            ctx.setLineDash([]);
            ctx.strokeStyle = "#c0c0c0";
            ctx.stroke();
        }

        // dashed lines
        for(var i=0; i<hours*divs; i++) {
            ctx.beginPath();
            var y = tmargin + Math.round(i * vspace)+0.5;
            ctx.moveTo(lmargin, y);
            ctx.lineTo(canvas.width, y);
            ctx.lineWidth = 1;
            ctx.setLineDash([3, 1]);
            ctx.strokeStyle = "#e0e0e0";
            ctx.stroke();
            ctx.setLineDash([]);
        }
        
        // full lines
        for(var i=0; i<hours; i++) {
            ctx.beginPath();
            var y = tmargin + Math.round(i * vspace_h)+0.5;
            ctx.moveTo(lmargin, y);
            ctx.lineTo(canvas.width, y);
            ctx.lineWidth = 1;
            ctx.strokeStyle = "#c0c0c0";
            ctx.stroke();
        }

        // current time line
        var lc = dayOfWeek;
        var lx = lc * hspace + lmargin;
        var hy = (hour - top_hour) * vspace_h + tmargin;
        var ty = hy + (minutes/60.0) * vspace_h;
        var ly = Math.round(ty)+0.5;
        ctx.beginPath();
        ctx.moveTo(lx, ly);
        ctx.lineTo(lx+hspace, ly);
        ctx.lineWidth = 3;
        ctx.setLineDash([]);
        ctx.strokeStyle = "#ff0000";
        ctx.stroke();

    }
    else if(viewMode === 'month') {
        var tmargin = viewVars['month'].tmargin;
        var vspace = (canvas.height-tmargin)/6;
        var hspace = (canvas.width)/7;

        ctx.font = "18px Arial";
        ctx.fillStyle = "#000000";
        for(var i=0; i<7; i++) {
            ctx.fillText(weekdays[i],i*hspace+10,tmargin-10);
        }

        ctx.font = "18px Arial";
        ctx.fillStyle = "#000000";
        for(var i=0; i<31; i++) {
            var r = Math.floor(i/7);
            var c = i - r*7;
            ctx.fillText("" + (i+1),c*hspace+10,r*vspace+tmargin+30);
        }

        // full lines
        for(var i=0; i<6; i++) {
            ctx.beginPath();
            var y = tmargin + Math.round(i * vspace)+0.5;
            ctx.moveTo(0, y);
            ctx.lineTo(canvas.width, y);
            ctx.lineWidth = 1;
            ctx.strokeStyle = "#c0c0c0";
            ctx.stroke();
        }

        // full lines
        for(var i=0; i<7; i++) {
            ctx.beginPath();
            var x = Math.round(i * hspace)+0.5;
            ctx.moveTo(x, 0);
            ctx.lineTo(x, canvas.height);
            ctx.lineWidth = 1;
            ctx.strokeStyle = "#c0c0c0";
            ctx.stroke();
        }

    }
    else if(viewMode === 'year') {

        ctx.lineWidth = 1;

        var rows = viewVars['year'].rows;
        var cols = Math.round(12/rows);

        var hm = 100;
        var vm = 100;
        var sm = 50;
        var bw = ((canvas.width - 2*hm) / cols) - sm;
        var bh = ((canvas.height- 2*vm) / rows) - sm;
        for(var r=0; r<rows; r++) {
            for(var c=0; c<cols; c++) {
		        ctx.beginPath();
		        var x = Math.round(c*(bw+sm)+hm+sm/2) + 0.5;
		        var y = Math.round(r*(bh+sm)+vm+sm/2) + 0.5;
		        ctx.rect(x,y,bw,bh);
		        ctx.strokeStyle = "#000000";
		        ctx.stroke();
		        ctx.fillStyle = "#ffffff";
		        ctx.fill();

		        ctx.strokeStyle = "#c0c0c0";
                for(var mc=1; mc < 7; mc++) {
		            ctx.beginPath();
		            var bx = Math.round(x+mc*bw/7) + 0.5;
                    ctx.moveTo(bx, y);
                    ctx.lineTo(bx, y+bh);
		            ctx.stroke();
                }
                for(var mr=1; mr < 6; mr++) {
		            ctx.beginPath();
		            var by = Math.round(y+mr*bh/6) + 0.5;
                    ctx.moveTo(x,    by);
                    ctx.lineTo(x+bw, by);
		            ctx.stroke();
                }

                ctx.font = "18px Arial";
                ctx.fillStyle = "#000000";
                ctx.fillText(months[r*4+c],x+20,y-10);
            }
        }

    }
    else if(viewMode === 'year2') {
        var bw = viewVars['year2'].bw;
        var lm = (canvas.width - 31*bw)/2;
        var tm = (canvas.height - 12*bw)/2;
        ctx.lineWidth = 1;
        ctx.font = "18px Arial";
        ctx.fillStyle = "#000000";
        for(var r=0; r<12; r++) {
            var y = Math.round(bw*r+tm) + 0.5;
            ctx.fillText(months[r],lm-100,y+30);
            for(var c=0; c<31; c++) {
                var x = Math.round(bw*c+lm) + 0.5;
                ctx.beginPath();
		        ctx.rect(x,y,bw,bw);
		        ctx.strokeStyle = "#000000";
		        ctx.stroke();
		        //ctx.fillStyle = "#ffffff";
		        //ctx.fill();
            }
        }
    }
    else if(viewMode === 'sidebar') {
        var width = viewVars['sidebar'].width;
        for(var r=0; r<52; r++) {
            var y = Math.round(r*canvas.height/52) + 3.5;
            for(var c=0; c<7; c++) {
                var x = Math.round(c*20) + 5.5;
                ctx.beginPath();
                ctx.rect(x,y,15,15);
		        if((r==30) && (c==0)) {
		            ctx.fillStyle = "#c0c0c0";
		            ctx.fill();
                }
		        ctx.strokeStyle = "#000000";
		        ctx.stroke();
            }
        }
    }

}

function myFunction(e) {
    console.log('wheel');
    console.log(e);
}

document.getElementById("myCanvas").addEventListener("wheel", (e) => {myFunction(e);} );

document.addEventListener('keydown', (event) => {
	const keyName = event.key;
	if (keyName === 'Control') {
		return;
	}
	if (event.ctrlKey) {
		console.log(`Combination of ctrlKey + ${keyName}`);
	} else {
		console.log(`Key pressed ${keyName}`);
        if(keyName === 'd') {
            viewMode = 'day';
        }
        if(keyName === 'w') {
            viewMode = 'week';
        }
        if(keyName === 'm') {
            viewMode = 'month';
        }
        if(keyName === 'y') {
            if(viewMode === 'year') {
                viewMode = 'year2';
            }
            else if(viewMode === 'year2') {
                viewMode = 'year';
            }
            else {
                viewMode = 'year';
            }
        }
        if(keyName === 's') {
            viewMode = 'sidebar';
        }
	}
}, false);

setInterval(draw, 100);

</script>

</body>

</html>
